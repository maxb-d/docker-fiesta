# Overview
Nest CRUD API is a boilerplate fragment implementing an external api call

## Functionnalities
- User
  - Auth
  - Register
  - Refresh token functionnality
  - Update
  - Get all users (only for monitoring and development purposes, not a functionnality to release in production)
- Food
  - External API call to OpenFoodFacts (Protected route)
  - Caching of the result

## Tech stack
The crud api is a Typescript PERN application

### Backend
- NestJs on top of ExpressJs
- JWT and Passport (Authentication)

### Database
- Prisma (ORM) on top of PostgreSQL
- Redis for caching

### Dockerization
- Dockerfile for the nest app
- Postgres and Redis images pulled from DockerHub
- Docker-compose file to orchestrate the container

## Getting started

### Environment
First you will need a .env file configuring the environment, the file should have the following structure: 

```js
PORT=3000

AT_SECRET='auth-token-secret'
RT_SECRET='refresh-token-secret'

POSTGRES_DB="db_name"
POSTGRES_USER="user"
POSTGRES_PASSWORD="password"

REDIS_HOST="redis"
REDIS_PORT="6379"
```

- You should replace the values by appropriate values for the project, and generate random keys in a proper way for the tokens

### Docker
Build the docker image for the nest app

```js
docker build -t <name_of_the_app> .
```

Pull the redis and postgres images and run the containers: 

```js
docker-compose up -d
```

You should now have an instance accessible at localhost:3000

## Good to know

### OpenFoodFacts

The application is making an external call to the OpenFoodFacts API, the route is 'http://localhost:3000/food/${barcode}

You should replace the barcode variable with the barcode of the food item you want to retrieve

The route is protected so you should be authenticated to access it

The result of the api call is cached for 2 seconds

### User route

The get all users route is only here for monitoring developpment purposes

### Refresh

A refresh token functionnality is implemented, you should use the refresh token generated by the api and the dedicated route to refresh the user's access according to the refresh token functionnality principles

